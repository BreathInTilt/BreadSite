{% extends "orders/base.html" %}

{% block title %}
Personal Cabinet - BreadSite
{% endblock %}

{% block content %}
<div class="px-4 md:px-40 flex flex-1 justify-center py-5">
    <div class="flex flex-col max-w-[960px] w-full">
        <!-- Заголовок -->
        <h1 class="text-[#181411] text-[32px] font-bold leading-tight mt-3 text-center">
            Personal Cabinet
        </h1>

        <!-- Информация о пользователе -->
        <div class="bg-white p-6 rounded-xl shadow-lg mt-6">
            <div class="flex items-center gap-4">
                {% if user.profile.avatar %}
                    <img src="{{ user.profile.avatar.url }}" alt="Avatar" class="w-16 h-16 rounded-full object-cover">
                {% else %}
                    <div class="w-16 h-16 rounded-full bg-gray-200 flex items-center justify-center text-gray-500">
                        No Avatar
                    </div>
                {% endif %}
                <div>
                    <h2 class="text-xl font-semibold text-[#181411]">
                        {{ user.first_name }} {{ user.last_name }}
                    </h2>
                    <p class="text-[#887263] text-sm">Email: {{ user.email }}</p>
                    <a href="{% url 'profile_edit' %}" class="mt-2 inline-block rounded-xl h-10 bg-[#e66e19] text-white text-sm font-bold leading-normal px-4 flex items-center justify-center btn-custom">
                        Edit Profile
                    </a>
                </div>
            </div>
            {% if user.profile.bio %}
                <p class="text-[#887263] mt-4"><strong>Bio:</strong> {{ user.profile.bio }}</p>
            {% endif %}
            <div class="mt-4 text-[#887263]">
                <p><strong>Total Orders:</strong> {{ total_orders }}</p>
                <p><strong>Total Spent:</strong> ${{ total_spent|floatformat:2 }}</p>
            </div>
        </div>

        <!-- Список заказов -->
        <h2 class="text-[#181411] text-2xl font-bold leading-tight mt-8 mb-4">Your Orders</h2>
        {% if orders %}
            {% for entry in orders %}
                {% with order=entry.order %}
                    <div class="bg-white p-6 rounded-xl shadow-lg mb-4">
                        <h3 class="text-xl font-semibold text-[#181411]">Order #{{ order.id }}</h3>
                        <p class="text-[#887263] text-sm">Placed on: {{ order.created_at }}</p>
                        <p class="text-[#887263] text-sm">Item: {{ order.quantity }} x {{ order.bread.name }} - ${{ entry.total_price|floatformat:2 }}</p>
                        <p class="text-[#887263] text-sm">Address: {{ order.address }}</p>
                        <p class="text-[#887263] text-sm">Phone: {{ order.phone }}</p>
                    </div>
                {% endwith %}
            {% endfor %}
        {% else %}
            <p class="text-[#887263] text-center">You have no orders yet.</p>
            <div class="text-center mt-4">
                <a href="{% url 'bread_list' %}" class="inline-block rounded-xl h-10 bg-[#e66e19] text-white text-sm font-bold leading-normal px-4 flex items-center justify-center btn-custom">
                    Continue Shopping
                </a>
            </div>
        {% endif %}
    </div>
</div>
{% endblock %}